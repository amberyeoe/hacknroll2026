{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block css %}
<link rel="stylesheet" href="../static/dashboard.css">
{% endblock %}

{% block content %}
<div class="dash-wrap">
  <div class="dash">

    <!-- LEFT -->
    <section class="dash-left">
      <div class="dash-title">LATEST IPPT</div>

      <div class="metrics">
        <div class="metric">
          <div class="metric-value">{{ pushups | default(25) }}</div>
          <div class="metric-label">PUSH-UPS</div>
        </div>

        <div class="metric">
          <div class="metric-value">{{ situps | default(25) }}</div>
          <div class="metric-label">SIT-UPS</div>
        </div>

        <div class="metric">
          <div class="metric-value">{{ run_time | default('14:40') }}</div>
          <div class="metric-label">2.4 KM RUN</div>
        </div>
      </div>

      <div class="info-row">
        <div class="info-label">SCORE:</div>
        <div class="info-value">{{ score | default(60) }}</div>
      </div>

      <!-- STATUS (FAIL/PASS/SILVER/GOLD) -->
      <div class="info-row">
        <div class="info-label">CURRENT IPPT STATUS:</div>

        {% set tier = tier | default('PASS') %}
        <div class="info-value status tier-{{ tier|lower }}">
          {{ tier }}
        </div>
      </div>

      <div class="spacer"></div>

      <div class="info-row">
        <div class="info-label">CREDITS:</div>
        <div class="info-value">{{ credits | default(300) }}</div>
      </div>

      <!-- XP + LEVEL + BAR -->
      <div class="xp-block">
        <div class="xp-top">
          <div class="info-label">XP:</div>

          <div class="xp-meta">
            <span class="xp-level">LVL {{ level | default(1) }}</span>
            <span class="xp-total">{{ xp | default(0) }} XP</span>
          </div>
        </div>

        <div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"
             aria-valuenow="{{ xp_percent | default(52) }}">
          <div class="xp-fill" style="width: {{ xp_percent | default(52) }}%;"></div>
        </div>

        <div class="xp-sub">
          {{ xp_progress | default(0) }}/{{ xp_need | default(100) }} to next level
        </div>
      </div>

    </section>

    <!-- RIGHT -->
    <aside class="dash-right">
      <div class="avatar-frame">

        {# -------- Badge logic (based on score) -------- #}
        {% set score_val = (score | default(0)) | int %}
        {% set badge_file = none %}

        {# <51 = no badge #}
        {% if score_val >= 85 %}
          {% set badge_file = 'gold.jpg' %}
        {% elif score_val >= 75 %}
          {% set badge_file = 'silver.jpg' %}
        {% elif score_val >= 61 %}
          {% set badge_file = 'bronze.jpg' %}
        {% elif score_val >= 51 %}
          {% set badge_file = 'pass.jpg' %} {# your "white" badge #}
        {% endif %}
        {# --------------------------------------------- #}

        {% if avatar_url %}
          <img src="{{ avatar_url }}" alt="Avatar" class="avatar-img">
        {% else %}
          <div class="avatar-placeholder">AVATAR</div>
        {% endif %}

        {# Badge overlay image (separate element, on top-right) #}
        {% if badge_file %}
          <img
            src="{{ url_for('static', filename='home_backgrnd/' ~ badge_file) }}"
            alt="IPPT badge"
            class="ippt-badge"
          >
        {% endif %}

      </div>
    </aside>

  </div>
</div>
{% endblock %}
